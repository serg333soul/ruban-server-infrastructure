name: Deploy Infrastructure

on:
  push:
    branches: [ "main" ]

jobs:
  deploy:
    runs-on: self-hosted
    steps:
      - name: Check out code
        uses: actions/checkout@v4

      - name: Update Scripts
        run: |
          echo "üîÑ Updating scripts..."
          # –ö–æ–ø—ñ—é—î–º–æ –∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é –≤ —Ä–æ–±–æ—á—É –ø–∞–ø–∫—É (—Ç–µ–ø–µ—Ä –≤–æ–Ω–∞ —Ç–∞ —Å–∞–º–∞!)
          # –û—Å–∫—ñ–ª—å–∫–∏ Runner –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –ø–∞–ø–∫–∏ repo, –Ω–∞–º —Ç—Ä–µ–±–∞ –ø—Ä–æ—Å—Ç–æ —Å–∫–æ–ø—ñ—é–≤–∞—Ç–∏
          # –ê–õ–ï! Runner —Å–∫–∞—á—É—î –∫–æ–¥ —É —Å–≤–æ—é –ø–∞–ø–∫—É actions-runner/_work/...
          # –¢–æ–º—É –Ω–∞–º —Ç—Ä–µ–±–∞ —Å–∫–æ–ø—ñ—é–≤–∞—Ç–∏ –∑ –ø–æ—Ç–æ—á–Ω–æ—ó –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó (.) —É —Ü—ñ–ª—å–æ–≤—É
          
          TARGET_DIR="/home/ruban/my-projects/ruban-infra"
          
          cp ./scripts/*.sh $TARGET_DIR/scripts/
          chmod +x $TARGET_DIR/scripts/*.sh
          
          # –û–Ω–æ–≤–ª—é—î–º–æ docker-compose —Ñ–∞–π–ª–∏
          cp ./services/nextcloud/docker-compose.yml $TARGET_DIR/services/nextcloud/
          cp ./services/monitoring/docker-compose.yml $TARGET_DIR/services/monitoring/
          # cp ./services/proxy/docker-compose.yml $TARGET_DIR/services/proxy/
          
          echo "‚úÖ Files updated via CI/CD"

      # –û–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ: –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ–≤, —è–∫—â–æ –∑–º—ñ–Ω–∏–≤—Å—è compose —Ñ–∞–π–ª
      # - name: Restart Nextcloud if needed
      #   run: |
      #     cd /home/ruban/my-projects/ruban-infra/services/nextcloud
      #     docker compose up -d